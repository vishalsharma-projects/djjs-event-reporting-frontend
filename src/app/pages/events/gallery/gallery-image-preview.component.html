<div class="gallery-preview-modal">
  <!-- Header -->
  <div class="gallery-preview-header">
    <h5 class="gallery-preview-title" *ngIf="item" [title]="getFullFilename(item)">
      {{ truncateFilename(item?.name || '', 50) }}
    </h5>
    <div class="gallery-preview-actions">
      <button 
        class="btn btn-sm btn-light me-2" 
        (click)="handleDownload($event)" 
        title="Download"
        type="button">
        <i class="pi pi-download"></i>
      </button>
      <button 
        class="btn btn-sm btn-danger me-2" 
        (click)="handleDelete($event)" 
        title="Delete"
        type="button">
        <i class="pi pi-trash"></i>
      </button>
      <button 
        class="btn btn-sm btn-secondary" 
        (click)="handleClose($event)" 
        title="Close"
        type="button">
        <i class="pi pi-times"></i>
      </button>
    </div>
  </div>

  <!-- Body - Scrollable -->
  <div class="gallery-preview-body">
    <ng-container *ngIf="item && items?.length > 0" [ngSwitch]="item.type">
      <!-- Image Preview -->
      <div *ngSwitchCase="'image'" class="gallery-preview-image-container">
        <!-- Loading state -->
        <div *ngIf="imageLoading" class="gallery-preview-loading">
          <i class="pi pi-spin pi-spinner" style="font-size: 3rem; color: #ff6b35;"></i>
          <p class="mt-3">Loading image...</p>
        </div>
        
        <!-- Image -->
        <img 
          *ngIf="imageUrl && !imageError && !imageLoading" 
          [src]="imageUrl"
          [alt]="item.name" 
          (error)="onImageError($event)" 
          (load)="onImageLoad($event)"
          loading="eager"
          class="gallery-preview-image">
        
        <!-- Error state with retry -->
        <div *ngIf="imageError && !imageLoading" class="gallery-preview-placeholder">
          <i class="pi pi-image" style="font-size: 5rem; color: #ccc;"></i>
          <p class="mt-3">{{ item.name }}</p>
          <small class="text-muted d-block mb-3">{{ errorMessage || 'Image unavailable' }}</small>
          <button class="btn btn-sm btn-primary" (click)="retryLoad()" type="button">
            <i class="pi pi-refresh me-1"></i> Retry
          </button>
        </div>
      </div>

      <!-- Video Preview -->
      <div *ngSwitchCase="'video'" class="gallery-preview-video-container">
        <video 
          *ngIf="item.url && !videoError" 
          controls 
          autoplay
          (error)="onVideoError($event)" 
          class="gallery-preview-video">
          <source [src]="item.url" type="video/mp4">
          Your browser does not support the video tag.
        </video>
        <div *ngIf="!item.url || videoError" class="gallery-preview-placeholder">
          <i class="pi pi-video"></i>
          <p class="mt-3">{{ item.name }}</p>
          <small class="text-muted">Video unavailable</small>
        </div>
      </div>

      <!-- Audio Preview -->
      <div *ngSwitchCase="'audio'" class="gallery-preview-audio-container">
        <audio 
          *ngIf="item.url && !audioError" 
          controls 
          autoplay
          (error)="onAudioError($event)" 
          class="gallery-preview-audio">
          <source [src]="item.url" type="audio/mpeg">
          Your browser does not support the audio tag.
        </audio>
        <div *ngIf="!item.url || audioError" class="gallery-preview-placeholder">
          <i class="pi pi-volume-up"></i>
          <p class="mt-3">{{ item.name }}</p>
          <small class="text-muted">Audio unavailable</small>
        </div>
      </div>

      <!-- File Preview (PDF/Documents) -->
      <div *ngSwitchCase="'file'" class="gallery-preview-file-container">
        <iframe 
          [src]="item.url" 
          class="gallery-preview-iframe">
        </iframe>
      </div>
    </ng-container>
    <div *ngIf="!item" class="gallery-preview-placeholder">
      <i class="pi pi-spin pi-spinner" style="font-size: 3rem; color: #ff6b35;"></i>
      <p class="mt-3">Loading...</p>
    </div>
  </div>
</div>

