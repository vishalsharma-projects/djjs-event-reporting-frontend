<!-- PrimeNG Toast Component -->
<p-toast
  position="top-right"
  [baseZIndex]="12000"
  [showTransformOptions]="'translateX(100%)'"
  [hideTransformOptions]="'translateX(100%)'"
  [showTransitionOptions]="'300ms ease-out'"
  [hideTransitionOptions]="'300ms ease-in'"
  (onClose)="onToastClose($event)"
  (onClick)="onToastClick($event)">
</p-toast>

<section class="event-stepper">
  <!-- Page Title -->
  <div class="row">
    <div class="col-12">
      <div class="page-title-box d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <button class="btn btn-link text-decoration-none me-3" (click)="goBack()">
            <i class="fas fa-arrow-left"></i>
          </button>
          <h4 class="mb-0">{{ isEditing ? 'EDIT EVENT' : 'ADD EVENT' }}</h4>
        </div>
        <div class="d-flex align-items-center gap-2">
          <!-- Validation Toggle -->
          <!-- <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="validationToggle"
              [checked]="validationSettings.getSettings().enabled"
              (change)="validationSettings.toggleValidation()">
            <label class="form-check-label" for="validationToggle"
              [class.text-success]="validationSettings.getSettings().enabled"
              [class.text-muted]="!validationSettings.getSettings().enabled">
              <i class="fas" [ngClass]="validationSettings.getSettings().enabled ? 'fa-check-circle' : 'fa-times-circle'"></i>
              Validation {{ validationSettings.getSettings().enabled ? 'ON' : 'OFF' }}
            </label>
          </div> -->
          <button class="btn btn-outline-danger btn-sm" (click)="clearDraftAndStartFresh()" *ngIf="draftId">
            <i class="fas fa-trash-alt me-1"></i> Clear Draft
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Stepper Progress -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="stepper-progress">
        <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
          <div class="step-number">1</div>
          <div class="step-label">General Details</div>
        </div>
        <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
          <div class="step-number">2</div>
          <div class="step-label">Media & promotion</div>
        </div>
        <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3">
          <div class="step-number">3</div>
          <div class="step-label">Special guests</div>
        </div>
        <div class="step" [class.active]="currentStep === 4">
          <div class="step-number">4</div>
          <div class="step-label">Volunteers</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ================= STEP 1 : GENERAL DETAILS ================= -->
<div *ngIf="currentStep === 1">

  <form [formGroup]="generalDetailsForm">
    <div class="common-stepper">
      <h5 class="mb-3">Event details</h5>
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Type <span class="text-danger">*</span></label>
          <ng-select formControlName="eventType" 
            [items]="eventTypes"
            bindLabel="name"
            bindValue="name"
            [searchable]="true"
            [clearable]="true"
            placeholder="{{ loadingEventTypes ? 'Loading...' : 'Select Event Type' }}"
            [disabled]="loadingEventTypes"
            [ngClass]="{'is-invalid': isFieldInvalid('eventType')}">
          </ng-select>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('eventType')">
            Event Type is required.
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Event category <span class="text-danger">*</span></label>
          <ng-select formControlName="eventCategory"
            [items]="filteredEventCategories"
            bindLabel="name"
            bindValue="name"
            [searchable]="true"
            [clearable]="true"
            [placeholder]="loadingEventCategories ? 'Loading...' : (filteredEventCategories.length === 0 ? 'Select Event Type first' : 'Select Category')"
            [disabled]="loadingEventCategories || filteredEventCategories.length === 0"
            [ngClass]="{'is-invalid': isFieldInvalid('eventCategory')}">
          </ng-select>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('eventCategory')">
            Event Category is required.
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Event sub category</label>
          <ng-select formControlName="eventSubCategory"
            [items]="filteredEventSubCategories"
            bindLabel="name"
            bindValue="name"
            [searchable]="true"
            [clearable]="true"
            [placeholder]="loadingEventSubCategories ? 'Loading...' : (filteredEventSubCategories.length === 0 ? 'Select Event Category first' : 'Select Sub Category')"
            [disabled]="loadingEventSubCategories || filteredEventSubCategories.length === 0">
          </ng-select>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Scale</label>
          <ng-select formControlName="scale"
            [items]="scales"
            [searchable]="true"
            [clearable]="true"
            placeholder="Select Scale">
          </ng-select>
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Theme</label>
          <ng-select formControlName="theme"
            [items]="themes"
            bindLabel="name"
            bindValue="name"
            [searchable]="true"
            [clearable]="true"
            [placeholder]="loadingThemes ? 'Loading...' : 'Select Theme'"
            [disabled]="loadingThemes">
          </ng-select>
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Language</label>
          <ng-select formControlName="language"
            [items]="languages"
            [searchable]="true"
            [clearable]="true"
            placeholder="Select Language">
          </ng-select>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Duration <span class="text-danger">*</span></label>
          <div class="row g-2">
            <div class="col-6">
              <input type="date" class="form-control" placeholder="Start Date" formControlName="startDate"
                (change)="onStartDateChange()" autocomplete="off"
                [ngClass]="{'is-invalid': isFieldInvalid('duration')}">
            </div>
            <div class="col-6">
              <input type="date" class="form-control" placeholder="End Date" formControlName="endDate"
                (change)="onEndDateChange()" autocomplete="off"
                [ngClass]="{'is-invalid': isFieldInvalid('duration')}">
            </div>
          </div>
          <input type="hidden" formControlName="duration">
          <small class="text-muted" *ngIf="getDurationDisplay()">{{ getDurationDisplay() }}</small>
          <div class="invalid-feedback d-block" *ngIf="isFieldInvalid('duration')">
            Duration is required. Please select start and end dates.
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Daily Start Time</label>
          <input type="time" class="form-control" formControlName="dailyStartTime">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Daily End Time</label>
          <input type="time" class="form-control" formControlName="dailyEndTime">
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Spiritual Orator</label>
          <ng-select formControlName="spiritualOrator"
            [items]="orators"
            bindLabel="name"
            bindValue="name"
            [searchable]="true"
            [clearable]="true"
            [placeholder]="loadingOrators ? 'Loading...' : 'Select Spiritual Orator'"
            [disabled]="loadingOrators">
          </ng-select>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Branch</label>
          <ng-select formControlName="branchId"
            [items]="branches"
            bindLabel="name"
            bindValue="id"
            [searchable]="true"
            [clearable]="true"
            [placeholder]="loadingBranches ? 'Loading...' : 'Select Branch'"
            [disabled]="loadingBranches">
          </ng-select>
        </div>
      </div>
    </div>
    <!-- Venue Section -->
    <div class="common-stepper">
      <h5 class="mb-3">Venue</h5>
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Country <span class="text-danger">*</span></label>
          <ng-select formControlName="country"
            [items]="countries"
            bindLabel="name"
            bindValue="name"
            [searchable]="true"
            [clearable]="true"
            placeholder="Select Country"
            [ngClass]="{'is-invalid': isFieldInvalid('country')}">
          </ng-select>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('country')">
            Country is required.
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">State <span class="text-danger">*</span></label>
          <ng-select formControlName="state"
            [items]="filteredStates"
            bindLabel="name"
            bindValue="name"
            [searchable]="true"
            [clearable]="true"
            placeholder="Select State"
            [ngClass]="{'is-invalid': isFieldInvalid('state')}">
          </ng-select>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('state')">
            State is required.
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">City <span class="text-danger">*</span></label>
          <ng-select formControlName="city"
            [items]="filteredCities"
            bindLabel="name"
            bindValue="name"
            [searchable]="true"
            [clearable]="true"
            [placeholder]="loadingCities ? 'Loading...' : (filteredCities.length === 0 ? 'Select State first' : 'Select City')"
            [disabled]="loadingCities || filteredCities.length === 0"
            [ngClass]="{'is-invalid': isFieldInvalid('city')}">
          </ng-select>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('city')">
            City is required.
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Pincode</label>
          <input type="text" class="form-control" formControlName="pincode" placeholder="Enter pincode">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Post office</label>
          <input type="text" class="form-control" formControlName="postOffice">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Police station</label>
          <input type="text" class="form-control" formControlName="policeStation">
        </div>
      </div>

      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Address type</label>
          <ng-select formControlName="addressType"
            [items]="addressTypes"
            [searchable]="true"
            [clearable]="true"
            placeholder="Select Address Type">
          </ng-select>
        </div>
        <div class="col-md-8 mb-3">
          <label class="form-label">Address <span class="text-danger">*</span></label>
          <input type="text" class="form-control" formControlName="address"
            [ngClass]="{'is-invalid': isFieldInvalid('address')}">
          <div class="invalid-feedback" *ngIf="isFieldInvalid('address')">
            Address is required.
          </div>
        </div>
      </div>

      <!-- <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Prachar</label>
          <ng-select formControlName="prachar"
            [items]="pracharAreas"
            [multiple]="true"
            [searchable]="true"
            [clearable]="true"
            placeholder="Select Prachar Areas">
          </ng-select>
        </div>
      </div> -->
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Area covered</label>
          <input type="text" class="form-control" formControlName="areaCovered" placeholder="0.00 Sq km">
        </div>
      </div>
      
    </div>
    <!-- Donations -->
    <!-- <div class="common-stepper">
      <h5 class="mt-4 mb-3">Donations</h5>

      <div class="row">
        <div class="col-md-3 mb-3">
          <label class="form-label">Donation type</label>
          <select class="form-select" formControlName="donationType">
            <option value="cash">Cash</option>
            <option value="in-kind">In-kind</option>
          </select>
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">Amount</label>
          <input type="number" class="form-control" formControlName="amount" placeholder="Amount in Rupees">
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">In-kind type</label>
          <input type="text" class="form-control" formControlName="inKindType" placeholder="Rice 5kg, Bedsheet 2...">
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">Estimated material value</label>
          <input type="number" class="form-control" formControlName="materialValue" placeholder="Amount in Rupees">
        </div>
      </div>
</div> -->
    <!-- Donations -->
    <div class="common-stepper">
      <h5 class=" mb-3">Donations</h5>

      <!-- Dynamic Donation Entries -->
      <div *ngFor="let donation of donationTypes; let i = index" class="row mb-3">
        <!-- Donation Type -->
        <div class="col-md-3">
          <label class="form-label">Donation type</label>
          <ng-select [(ngModel)]="donation.type" [ngModelOptions]="{standalone: true}" (change)="onDonationTypeChange(i)"
            [items]="['cash', 'in-kind']"
            [searchable]="true"
            [clearable]="false"
            placeholder="Select Donation Type">
          </ng-select>
        </div>

        <!-- Cash Amount Field (shown only for cash type) -->
        <div class="col-md-3" *ngIf="donation.type === 'cash'">
          <label class="form-label">Amount</label>
          <div class="input-group">
            <span class="input-group-text">₹</span>
            <input type="number" class="form-control" [(ngModel)]="donation.amount" [ngModelOptions]="{standalone: true}" placeholder="Amount in Rupees">
          </div>
        </div>

        <!-- In-kind Type Field (shown only for in-kind type) -->
        <div class="col-md-3" *ngIf="donation.type === 'in-kind'">
          <label class="form-label">In-kind type</label>
          <div class="tag-input-container">
            <div class="tags-display">
              <span *ngFor="let tag of donation.tags; let tagIndex = index" class="tag-item">
                {{ tag }}
                <button type="button" class="tag-remove" (click)="removeTag(i, tagIndex)">
                  <i class="fas fa-times"></i>
                </button>
              </span>
              <input type="text" class="tag-input" [(ngModel)]="donation.currentInput" [ngModelOptions]="{standalone: true}"
                (keydown)="onTagInputKeydown($event, i)" placeholder="Type and press Enter/Space">
            </div>
            
          </div>
        </div>

        <!-- Estimated Material Value Field (shown only for in-kind type) -->
        <div class="col-md-3" *ngIf="donation.type === 'in-kind'">
          <label class="form-label">Estimated material value</label>
          <div class="input-group">
            <span class="input-group-text">₹</span>
            <input type="number" class="form-control" [(ngModel)]="donation.materialValue" [ngModelOptions]="{standalone: true}"
              placeholder="Amount in Rupees">
          </div>
        </div>

        <!-- Delete Button -->
        <div class="col-md-3 d-flex align-items-end">
          <button type="button" class="btn btn-warning btn-xs" (click)="removeDonationType(i)"
            [disabled]="donationTypes.length === 1">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>

      <!-- Add Donation Type Button -->
      <div class="mt-3">
        <button type="button" class="btn btn-warning btn-sm" (click)="addDonationType()">
          + Add donation type
        </button>
      </div>
    </div>
    <!-- Beneficiaries -->
    <div class="common-stepper">
      <h5 class="mb-3">Beneficiaries (0)</h5>
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Men</label>
          <input type="number" class="form-control" formControlName="beneficiariesMen">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Women</label>
          <input type="number" class="form-control" formControlName="beneficiariesWomen">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Children</label>
          <input type="number" class="form-control" formControlName="beneficiariesChildren">
        </div>
      </div>
    </div>
    <!-- Initiations -->
    <div class="common-stepper">
      <h5 class="mb-3">Initiations (0)</h5>
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Men</label>
          <input type="number" class="form-control" formControlName="initiationMen">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Women</label>
          <input type="number" class="form-control" formControlName="initiationWomen">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Children</label>
          <input type="number" class="form-control" formControlName="initiationChildren">
        </div>
      </div>
    </div>
    <!-- Navigation + Autosave -->
    <div class="d-flex justify-content-between align-items-center mt-4 common-stepper">
      <!-- Autosave Message -->
      <div class="text-success small">
        <i class="bi bi-check-circle"></i> All changes are autosaved
      </div>

      <!-- Next Button -->
      <button type="button" class="btn btn-primary" (click)="nextStep()">
        Next
      </button>
    </div>
  </form>
</div>


<!-- ================= STEP 2 : MEDIA & PROMOTION ================= -->
<!-- Step 2: Media & Promotion -->
<div *ngIf="currentStep === 2">
  <!-- Button to open Media Promotion Modal - Top Right Corner -->
  <div class="d-flex justify-content-end mb-3">
    <button type="button" class="btn btn-warning" (click)="openMediaPromotionModal()">
      <i class="fas fa-plus me-2"></i>Add Media Details
    </button>
  </div>
  
  <!-- Event Media Table -->
  <div class="common-stepper">
    <div class="d-flex justify-content-between align-items-center mt-4 mb-3">
      <h6 class="mb-0">List of Event Media ({{ filteredEventMediaList.length }})</h6>
      <div class="search-box" style="width: 300px;">
        <input type="text" class="form-control form-control-sm" placeholder="Search media..." 
          [(ngModel)]="eventMediaSearchTerm" />
      </div>
    </div>
    <div class="event-table-container mt-3">
      <p-table [value]="filteredEventMediaList" 
        [paginator]="true"
        [rows]="eventMediaPagination.rows"
        [first]="eventMediaPagination.first"
        [rowsPerPageOptions]="eventMediaPagination.rowsPerPageOptions"
        [tableStyle]="{ 'min-width': '100%' }">
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 120px;">Actions</th>
            <th>Type</th>
            <th>Company Name</th>
            <th>Company Email</th>
            <th>Company Website</th>
            <th>Gender</th>
            <th>Designation</th>
            <th>Contact</th>
            <!-- <th>Reference Person</th> -->
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-media let-i="rowIndex">
          <tr>
            <td>
              <div class="d-flex gap-1">
                <button class="btn btn-primary btn-sm" (click)="editEventMedia(i)" title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-danger btn-sm" (click)="removeEventMedia(i)" title="Remove">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
            <td>{{ media.mediaCoverageType }}</td>
            <td>{{ media.companyName }}</td>
            <td>{{ media.companyEmail }}</td>
            <td>{{ media.companyWebsite }}</td>
            <td>{{ media.gender }}</td>
            <td>{{ media.designation }}</td>
            <td>{{ media.contact }}</td>
            <!-- <td>{{ media.referencePersonName }}</td> -->
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="9" class="text-center text-muted">No event media added yet. Click "Add Media Details" to add.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <!-- Promotional Material Used -->
  <div class="common-stepper mt-4">
    <h5 class="mb-3">Promotional Material Used</h5>
    <div class="d-flex justify-content-end mb-3">
      <button type="button" class="btn btn-warning" (click)="openPromotionalMaterialModal()">
        <i class="fas fa-plus me-2"></i>Add Material Type
      </button>
    </div>
    <div class="d-flex justify-content-between align-items-center mt-4 mb-3">
      <h6 class="mb-0">List of Promotional Materials ({{ getFilteredPromotionalMaterials().length }})</h6>
      <div class="search-box" style="width: 300px;">
        <input type="text" class="form-control form-control-sm" placeholder="Search materials..." 
          [(ngModel)]="promotionalMaterialSearchTerm" />
      </div>
    </div>
    <div class="event-table-container mt-3">
      <p-table [value]="getFilteredPromotionalMaterials()" 
        [paginator]="true"
        [rows]="promotionalMaterialPagination.rows"
        [first]="promotionalMaterialPagination.first"
        [rowsPerPageOptions]="promotionalMaterialPagination.rowsPerPageOptions"
        [tableStyle]="{ 'min-width': '100%' }">
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 80px;">Actions</th>
            <th>Material Type</th>
            <th>Quantity</th>
            <th>Size</th>
            <th>Custom Dimension</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-material let-i="rowIndex">
          <tr>
            <td>
              <button class="btn btn-danger btn-sm" (click)="removeMaterialTypeByValidIndex(i)" title="Remove">
                <i class="fas fa-trash"></i>
              </button>
            </td>
            <td>{{ material.materialType }}</td>
            <td>{{ material.quantity }}</td>
            <td>{{ material.size }}</td>
            <td>{{ material.customHeight }} x {{ material.customWidth }} inch</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5" class="text-center text-muted">No promotional materials added yet. Click "Add Material Type" to add.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <!-- Media and Documentation -->
  <div class="common-stepper mt-4">
    <h5 class="mb-3">Media and Documentation</h5>
    <div class="row mb-3">
      <div class="col-12">
        <label class="form-label">Media Files (Photos, Videos, Documents)</label>
        <input type="file" class="form-control file-input-custom" (change)="onFileInputChange($event, 'allFiles')" 
          accept="image/*,video/*,.pdf,.doc,.docx" multiple />
        <small class="form-text text-muted">Select photos, videos, or documents to upload</small>
      </div>
    </div>
    <h6 class="mt-4">Uploaded Files ({{ fileMetadata.allFiles?.length || 0 }})</h6>
    <div class="uploaded-files-list mt-3" *ngIf="fileMetadata.allFiles && fileMetadata.allFiles.length > 0">
      <div class="d-flex flex-wrap gap-2">
        <div *ngFor="let file of fileMetadata.allFiles; let i = index" class="uploaded-file-item">
          <span class="file-name">{{ file.name }}</span>
          <button type="button" class="btn-remove-file" (click)="removeFile('allFiles', i)" title="Remove file">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>
    <div *ngIf="!fileMetadata.allFiles || fileMetadata.allFiles.length === 0" class="text-center text-muted mt-3 p-3">
      No files uploaded yet. Select files above to upload.
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-4 common-stepper">
    <div class="text-success small">
      <i class="bi bi-check-circle"></i> All changes are autosaved
    </div>
    <div>
      <button class="btn btn-warning me-2" (click)="previousStep()">Back</button>
      <button class="btn btn-primary" (click)="nextStep()">Next</button>
    </div>
  </div>
</div>


<!-- ================= STEP 3 : SPECIAL GUESTS ================= -->
<!-- Step 3: Special Guests -->
<div *ngIf="currentStep === 3">
  <!-- Button to open Special Guests Modal - Top Right Corner -->
  <div class="d-flex justify-content-end mb-3">
    <button type="button" class="btn btn-warning" (click)="openSpecialGuestsModal()">
      <i class="fas fa-plus me-2"></i>Add Special Guest
    </button>
  </div>

  <!-- Special Guest Table -->
  <div class="common-stepper">
    <div class="d-flex justify-content-between align-items-center mt-4 mb-3">
      <h6 class="mb-0">List of Special Guests ({{ filteredSpecialGuestList.length }})</h6>
      <div class="search-box" style="width: 300px;">
        <input type="text" class="form-control form-control-sm" placeholder="Search guests..." 
          [(ngModel)]="specialGuestSearchTerm" />
      </div>
    </div>
    <div class="event-table-container mt-3">
      <p-table [value]="filteredSpecialGuestList" 
        [paginator]="true"
        [rows]="specialGuestPagination.rows"
        [first]="specialGuestPagination.first"
        [rowsPerPageOptions]="specialGuestPagination.rowsPerPageOptions"
        [tableStyle]="{ 'min-width': '100%' }">
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 120px;">Actions</th>
            <th>Name (Phone no.)</th>
            <th>Gender</th>
            <th>Designation</th>
            <th>Organization</th>
            <th>Email</th>
            <th>City, State</th>
            <th>Personal no.</th>
            <th>Contact Person (Phone no.)</th>
            <th>Reference Person (Phone no.)</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-guest let-i="rowIndex">
          <tr>
            <td>
              <div class="d-flex gap-1">
                <button class="btn btn-primary btn-sm" (click)="editSpecialGuest(i)" title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-danger btn-sm" (click)="removeSpecialGuest(i)" title="Remove">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
            <td>{{ guest.firstName }} {{ guest.lastName }} ({{ guest.personalNumber }})</td>
            <td>{{ guest.gender }}</td>
            <td>{{ guest.designation }}</td>
            <td>{{ guest.organization }}</td>
            <td>{{ guest.email }}</td>
            <td>{{ guest.city }}, {{ guest.state }}</td>
            <td>{{ guest.personalNumber }}</td>
            <td>{{ guest.contactPerson }} ({{ guest.contactPersonNumber }})</td>
            <td>{{ guest.referencePersonName }} ({{ guest.referenceVolunteerId }})</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="10" class="text-center text-muted">No special guests added yet. Click "Add Special Guest" to add.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-4 common-stepper">
    <div class="text-success small">
      <i class="bi bi-check-circle"></i> All changes are autosaved
    </div>
    <div>
      <button class="btn btn-warning me-2" (click)="previousStep()">Back</button>
      <button class="btn btn-primary" (click)="nextStep()">Next</button>
    </div>
  </div>
</div>


<!-- ================= STEP 4 : VOLUNTEERS ================= -->
<!-- Step 4: Volunteers -->
<div *ngIf="currentStep === 4">
  <!-- Button to open Volunteers Modal - Top Right Corner -->
  <div class="d-flex justify-content-end mb-3">
    <button type="button" class="btn btn-warning" (click)="openVolunteersModal()">
      <i class="fas fa-plus me-2"></i>Add Volunteer
    </button>
  </div>

  <!-- Volunteer List Table -->
  <div class="common-stepper">
    <div class="d-flex justify-content-between align-items-center mt-4 mb-3">
      <h6 class="mb-0">List of Volunteers ({{ filteredVolunteerList.length }})</h6>
      <div class="search-box" style="width: 300px;">
        <input type="text" class="form-control form-control-sm" placeholder="Search volunteers..." 
          [(ngModel)]="volunteerSearchTerm" />
      </div>
    </div>
    <div class="event-table-container mt-3">
      <p-table [value]="filteredVolunteerList" 
        [paginator]="true"
        [rows]="volunteerPagination.rows"
        [first]="volunteerPagination.first"
        [rowsPerPageOptions]="volunteerPagination.rowsPerPageOptions"
        [tableStyle]="{ 'min-width': '100%' }">
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 120px;">Actions</th>
            <th>Name</th>
            <th>Contact no.</th>
            <th>No. of Days</th>
            <th>Seva involved</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-vol let-i="rowIndex">
          <tr>
            <td>
              <div class="d-flex gap-1">
                <button class="btn btn-primary btn-sm" (click)="editVolunteer(i)" title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-danger btn-sm" (click)="removeVolunteer(i)" title="Remove">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
            <td>{{ vol.name }}</td>
            <td>{{ vol.contact }}</td>
            <td>{{ vol.days }}</td>
            <td>{{ vol.seva }}</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5" class="text-center text-muted">No volunteers added yet. Click "Add Volunteer" to add.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <!-- Navigation Buttons -->
  <div class="d-flex justify-content-between mt-3 common-stepper">
    <button class="btn btn-warning" (click)="previousStep()">Back</button>
    <div>
      <button class="btn btn-secondary me-2" (click)="saveAsDraft()" [disabled]="loadingEvent">
        <i class="fas fa-save me-1"></i>Save as Draft
      </button>
      <button class="btn btn-success" (click)="onSubmit()" [disabled]="loadingEvent">
        <i class="fas fa-check me-1"></i>Submit
      </button>
    </div>
  </div>
</div>