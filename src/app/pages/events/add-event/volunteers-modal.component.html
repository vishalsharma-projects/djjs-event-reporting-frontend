<div class="modal-header">
  <h5 class="modal-title">Add Volunteer</h5>
  <button type="button" class="btn-close" (click)="onClose()" aria-label="Close"></button>
</div>
<div class="modal-body">
  <form [formGroup]="volunteersForm">
    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Branch Code</label>
        <input type="text" class="form-control" formControlName="volBranchId" placeholder="Enter branch code" />
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Search Volunteers</label>
        <div class="position-relative">
          <input type="text" class="form-control" formControlName="volSearchMember"
            placeholder="Search by name, mobile no., or email" 
            (focus)="onSearchFieldFocus()"
            (blur)="onHideVolunteerSuggestions()"
            (input)="onSearchVolunteers($any($event.target).value)" />
          <!-- Volunteer Suggestions Dropdown -->
          <div class="dropdown-menu show" *ngIf="showVolunteerSuggestions" 
            style="position: absolute; top: 100%; left: 0; right: 0; z-index: 1000; max-height: 300px; overflow-y: auto; display: block;">
            <!-- Loading state -->
            <div class="dropdown-item text-muted" *ngIf="searchingVolunteers">
              <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
              Searching...
            </div>
            <!-- Results -->
            <div *ngFor="let volunteer of volunteerSuggestions" 
              class="dropdown-item" 
              style="cursor: pointer; padding: 0.5rem 1rem;"
              (mousedown)="onSelectVolunteer(volunteer); $event.preventDefault()"
              (click)="onSelectVolunteer(volunteer); $event.preventDefault()">
              <div class="d-flex flex-column">
                <strong>{{ volunteer.volunteer_name || volunteer.name || 'N/A' }}</strong>
                <small class="text-muted" *ngIf="volunteer.contact">Contact: {{ volunteer.contact }}</small>
                <small class="text-muted" *ngIf="volunteer.email">Email: {{ volunteer.email }}</small>
                <small class="text-muted" *ngIf="volunteer.branch?.name">Branch: {{ volunteer.branch.name }}</small>
              </div>
            </div>
            <!-- No results message -->
            <div class="dropdown-item text-muted" *ngIf="!searchingVolunteers && volunteerSuggestions.length === 0">
              No volunteers found
            </div>
          </div>
          <div class="position-absolute top-0 end-0 p-2" *ngIf="searchingVolunteers">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Volunteer's name <span class="text-danger">*</span></label>
        <input type="text" class="form-control" formControlName="volName" placeholder="Enter volunteer's name"
          [ngClass]="{'is-invalid': volunteersForm.get('volName')?.invalid && volunteersForm.get('volName')?.touched}" />
        <div *ngIf="volunteersForm.get('volName')?.invalid && volunteersForm.get('volName')?.touched" class="invalid-feedback">
          Volunteer's name is required
        </div>
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Contact Number <span class="text-danger">*</span></label>
        <input type="tel" class="form-control" formControlName="volContact" placeholder="Enter contact number"
          pattern="[0-9]*" maxlength="15"
          [ngClass]="{'is-invalid': volunteersForm.get('volContact')?.invalid && volunteersForm.get('volContact')?.touched}" />
        <div *ngIf="volunteersForm.get('volContact')?.invalid && volunteersForm.get('volContact')?.touched" class="invalid-feedback">
          Contact number is required
        </div>
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">No. of Days <span class="text-danger">*</span></label>
        <input type="number" class="form-control" formControlName="volDays" placeholder="Enter number" min="1"
          [ngClass]="{'is-invalid': volunteersForm.get('volDays')?.invalid && volunteersForm.get('volDays')?.touched}" />
        <div *ngIf="volunteersForm.get('volDays')?.invalid && volunteersForm.get('volDays')?.touched" class="invalid-feedback">
          <span *ngIf="volunteersForm.get('volDays')?.errors?.['required']">Number of days is required</span>
          <span *ngIf="volunteersForm.get('volDays')?.errors?.['min']">Number of days must be at least 1</span>
        </div>
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Seva involved <span class="text-danger">*</span></label>
        <ng-select formControlName="volSeva"
          [items]="['Others', 'Media', 'Decoration', 'Logistics', 'Hospitality']"
          [searchable]="true"
          [clearable]="true"
          placeholder="Select Seva"
          [ngClass]="{'is-invalid': volunteersForm.get('volSeva')?.invalid && volunteersForm.get('volSeva')?.touched}">
        </ng-select>
        <div *ngIf="volunteersForm.get('volSeva')?.invalid && volunteersForm.get('volSeva')?.touched" class="invalid-feedback">
          Seva involved is required
        </div>
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Mention seva</label>
        <input type="text" class="form-control" formControlName="volMentionSeva" placeholder="Enter mention seva" />
      </div>
    </div>
  </form>
</div>
<div class="modal-footer">
  <button type="button" class="btn btn-outline-secondary" (click)="onClose()">Cancel</button>
  <button type="button" class="btn btn-primary" (click)="onAddVolunteer()"
    [disabled]="volunteersForm.invalid"
    style="background: linear-gradient(135deg, #ff6b35, #f7931e); border: none;">
    Add Volunteer
  </button>
</div>
