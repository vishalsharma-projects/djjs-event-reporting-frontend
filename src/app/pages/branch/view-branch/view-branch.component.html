<div class="container-fluid py-4">
  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-orange" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Branch Details -->
  <div *ngIf="!loading && branch">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">Branch Details</h2>
      <div>
        <button class="btn btn-secondary me-2" (click)="goBack()">
          <i class="pi pi-arrow-left me-2"></i>Back
        </button>
        <button class="btn btn-edit me-2" (click)="editBranch()">
          <i class="pi pi-pencil me-2"></i>Edit
        </button>
        <button class="btn btn-danger" (click)="deleteBranch()">
          <i class="pi pi-trash me-2"></i>Delete
        </button>
      </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs nav-tabs-custom mb-4" role="tablist">
      <li class="nav-item">
        <button class="nav-link"
          [ngClass]="{'active': activeTab === 'details'}"
          (click)="setActiveTab('details')"
          type="button">
          Branch Details
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link"
          [ngClass]="{'active': activeTab === 'members'}"
          (click)="setActiveTab('members')"
          type="button">
          Members ({{ membersCount }})
        </button>
      </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Branch Details Tab -->
      <div class="tab-pane" [ngClass]="{'show active': activeTab === 'details'}">
        <!-- Branch Information -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Branch Information</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Branch Name:</label>
            <span class="ms-2">{{ branch.name || 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Email:</label>
            <span class="ms-2">{{ branch.email || 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Contact Number:</label>
            <span class="ms-2">{{ branch.contact_number || 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Coordinator:</label>
            <span class="ms-2">{{ branch.coordinator_name || 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Established On:</label>
            <span class="ms-2">{{ branch.established_on ? (branch.established_on | date:'mediumDate') : 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Ashram Area:</label>
            <span class="ms-2">{{ branch.aashram_area ? branch.aashram_area + ' sq km' : 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Open Days:</label>
            <span class="ms-2">{{ branch.open_days || 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Start Time:</label>
            <span class="ms-2">{{ branch.daily_start_time || 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">End Time:</label>
            <span class="ms-2">{{ branch.daily_end_time || 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Status:</label>
            <span class="ms-2">
              <span class="badge" [ngClass]="branch.status ? 'bg-success' : 'bg-danger'">
                {{ branch.status ? 'Active' : 'Inactive' }}
              </span>
            </span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">NCR:</label>
            <span class="ms-2">
              <span class="badge" [ngClass]="branch.ncr ? 'bg-info' : 'bg-secondary'">
                {{ branch.ncr ? 'Yes' : 'No' }}
              </span>
            </span>
          </div>
          <div class="col-md-4 mb-3" *ngIf="branch.branch_code">
            <label class="form-label fw-bold">Branch Code:</label>
            <span class="ms-2">{{ branch.branch_code }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Location Information -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Location Information</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Country:</label>
            <span class="ms-2">{{ branch.country?.name || 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">State:</label>
            <span class="ms-2">{{ branch.state?.name || 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">City:</label>
            <span class="ms-2">{{ branch.city?.name || 'N/A' }}</span>
          </div>
          <div class="col-md-12 mb-3" *ngIf="branch.address">
            <label class="form-label fw-bold">Address:</label>
            <span class="ms-2">{{ branch.address }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Pincode:</label>
            <span class="ms-2">{{ branch.pincode || 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Post Office:</label>
            <span class="ms-2">{{ branch.post_office || 'N/A' }}</span>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label fw-bold">Police Station:</label>
            <span class="ms-2">{{ branch.police_station || 'N/A' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Infrastructure -->
    <div class="card mb-4" *ngIf="branchInfrastructure && branchInfrastructure.length > 0">
      <div class="card-header">
        <h5 class="mb-0">Infrastructure ({{ branchInfrastructure.length }})</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered table-striped">
            <thead class="table-light">
              <tr>
                <th>Room Type</th>
                <th>Number</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let infra of branchInfrastructure">
                <td>{{ infra.type || 'N/A' }}</td>
                <td>{{ infra.count || 'N/A' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

      </div>

      <!-- Members Tab -->
      <div class="tab-pane" [ngClass]="{'show active': activeTab === 'members'}">
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">Members ({{ membersCount }})</h5>
          </div>
          <div class="card-body">
            <app-branch-members-list [branchId]="branchId"></app-branch-members-list>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && !branch" class="alert alert-danger m-3" role="alert">
    <h5>Error</h5>
    <p>Branch not found or failed to load.</p>
  </div>
</div>

<p-toast></p-toast>

