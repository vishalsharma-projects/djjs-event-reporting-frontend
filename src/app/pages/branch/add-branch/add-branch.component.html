<form [formGroup]="branchForm" (ngSubmit)="onSubmit()" class="branch-form">

  <!-- Branch details -->
  <section class="card mb-4">
    <div class="card-body">
      <h5 class="mb-3">Branch details</h5>
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Coordinator <span class="text-danger">*</span></label>
          <select class="form-select" formControlName="coordinator">
            <option value="">Select</option>
            <option value="Amit Sharma">Amit Sharma</option>
            <option value="Priya Singh">Priya Singh</option>
            <option value="Rahul Verma">Rahul Verma</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Established on <span class="text-danger">*</span></label>
          <input type="date" class="form-control" formControlName="establishedOn" placeholder="dd MMM yyyy" />
        </div>
        <div class="col-md-4">
          <label class="form-label">Ashram area <span class="text-danger">*</span></label>
          <div class="input-group">
            <input class="form-control" formControlName="ashramArea" type="number" step="0.01" placeholder="Enter number" />
            <span class="input-group-text">Sq km</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Area allotted -->
  <section class="card mb-4">
    <div class="card-body">
      <h5 class="mb-3">Area allotted</h5>

      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Country <span class="text-danger">*</span></label>
          <select class="form-select" formControlName="country">
            <option value="">Select</option>
            <option *ngFor="let c of countryList" [value]="c">{{c}}</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">State <span class="text-danger">*</span></label>
          <select class="form-select" formControlName="state" [disabled]="!stateList.length">
            <option value="">Select</option>
            <option *ngFor="let s of stateList" [value]="s">{{s}}</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">City <span class="text-danger">*</span></label>
          <select class="form-select" formControlName="city" [disabled]="!cityList.length">
            <option value="">Select</option>
            <option *ngFor="let c of cityList" [value]="c">{{c}}</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Pincode <span class="text-danger">*</span></label>
          <input class="form-control" formControlName="pincode" placeholder="Pincode" />
        </div>
      </div>

      <div class="row g-3 mt-1">
        <div class="col-md-3">
          <label class="form-label">Post office <span class="text-danger">*</span></label>
          <input class="form-control" formControlName="postOffice" placeholder="Post office" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Thana</label>
          <input class="form-control" formControlName="thana" placeholder="Enter" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Tehsil</label>
          <input class="form-control" formControlName="tehsil" placeholder="Enter" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Districts <span class="text-danger">*</span></label>
          <select class="form-select" formControlName="districts" [disabled]="!districtOptions.length">
            <option value="">Select</option>
            <option *ngFor="let d of districtOptions" [value]="d">{{d}}</option>
          </select>
        </div>
      </div>

      <div class="row g-3 mt-1">
        <div class="col-md-4">
          <label class="form-label">Address type <span class="text-danger">*</span></label>
          <select class="form-select" formControlName="addressType">
            <option value="">Select</option>
            <option value="Residential">Residential</option>
            <option value="Commercial">Commercial</option>
          </select>
        </div>
        <div class="col-md-5">
          <label class="form-label">Address <span class="text-danger">*</span></label>
          <input class="form-control" formControlName="address" placeholder="Enter address" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Area covered</label>
          <div class="input-group">
            <input class="form-control" formControlName="areaCovered" type="number" step="0.01" placeholder="0.00" />
            <span class="input-group-text">Sq km</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Daily operation -->
  <section class="card mb-4">
    <div class="card-body">
      <h5 class="mb-3">Daily operation</h5>
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Open days</label>
          <input class="form-control" formControlName="openDays" placeholder="Enter days" />
        </div>
        <div class="col-md-4">
          <label class="form-label">Daily start time</label>
          <input type="time" class="form-control" formControlName="dailyStartTime" />
        </div>
        <div class="col-md-4">
          <label class="form-label">Daily end time</label>
          <input type="time" class="form-control" formControlName="dailyEndTime" />
        </div>
      </div>
    </div>
  </section>

  <!-- Add Members -->
  <section class="card mb-4">
    <div class="card-body">
      <h5 class="mb-3">Add Members</h5>
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Member Type <span class="text-danger">*</span></label>
          <select class="form-select" formControlName="memberType">
            <option value="samarpit">Samarpit Sewadar</option>
            <option value="preacher">Preacher</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Name <span class="text-danger">*</span></label>
          <input class="form-control" formControlName="name" type="text" placeholder="Enter name" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Role <span class="text-danger">*</span></label>
          <select class="form-select" formControlName="role">
            <option value="">Select</option>
            <option value="Coordinator">Coordinator</option>
            <option value="Volunteer">Volunteer</option>
            <option value="Member">Member</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Responsibility</label>
          <select class="form-select" formControlName="responsibility">
            <option value="">Select</option>
            <option value="Teaching">Teaching</option>
            <option value="Management">Management</option>
            <option value="Support">Support</option>
            <option value="Preach">Preach</option>
          </select>
        </div>
      </div>

      <div class="row g-3 mt-1">
        <div class="col-md-3">
          <label class="form-label">Age</label>
          <input class="form-control" formControlName="age" type="number" placeholder="Enter age" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Date of Samarpan</label>
          <input class="form-control" formControlName="dateOfSamarpan" type="date" placeholder="YYYY-MM-DD" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Qualification</label>
          <select class="form-select" formControlName="qualification">
            <option value="">Select</option>
            <option value="Graduate">Graduate</option>
            <option value="Post Graduate">Post Graduate</option>
            <option value="Diploma">Diploma</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Date of birth</label>
          <input class="form-control" formControlName="dateOfBirth" type="date" placeholder="YYYY-MM-DD" />
       
        </div>
      </div>

      <div class="row g-3 mt-1">
        
        <div class="col-md-3 d-flex align-items-end">
          <button type="button" class="btn btn-outline-primary w-100" (click)="addMember()">
            <i class="fas fa-plus me-2"></i>Add Member
          </button>
           </div>
      </div>
    </div>
  </section>

  <!-- List of Members -->
  <section class="card mb-4">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">List of Members ({{members.length}})</h5>
        <div class="btn-group">
          <button type="button"
                  class="btn btn-sm"
                  [ngClass]="{'btn-primary': activeMemberType==='preacher', 'btn-outline-primary': activeMemberType!=='preacher'}"
                  (click)="switchMemberType('preacher')">
            Preacher ({{preacherCount}})
          </button>
          <button type="button"
                  class="btn btn-sm"
                  [ngClass]="{'btn-primary': activeMemberType==='samarpit', 'btn-outline-primary': activeMemberType!=='samarpit'}"
                  (click)="switchMemberType('samarpit')">
            Samarpit Sewadar ({{samarpitCount}})
          </button>
        </div>
      </div>

      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th>Role</th>
              <th>Responsibility</th>
              <th>Age</th>
              <th>Date of samarpan</th>
              <th>Qualification</th>
              <th>Date of birth</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let member of filteredMembers">
              <td>{{member.value.name || '-'}}</td>
              <td>{{member.value.role || '-'}}</td>
              <td>{{member.value.responsibility || '-'}}</td>
              <td>{{member.value.age || '-'}}</td>
              <td>{{member.value.dateOfSamarpan || '-'}}</td>
              <td>{{member.value.qualification || '-'}}</td>
              <td>{{member.value.dateOfBirth || '-'}}</td>
            </tr>
            <tr *ngIf="filteredMembers.length === 0">
              <td colspan="7" class="text-center text-muted">No members to show</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between align-items-center">
        <small class="text-muted">
          Showing 1 to {{filteredMembers.length}} of {{filteredMembers.length}} entries
        </small>
        <div class="btn-group">
          <button type="button" class="btn btn-sm btn-outline-secondary">Previous</button>
          <button type="button" class="btn btn-sm btn-primary">1</button>
          <button type="button" class="btn btn-sm btn-outline-secondary">Next</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Infrastructure -->
  <section class="card mb-4">
    <div class="card-body">
      <h5 class="mb-3">Infrastructure</h5>

      <div formArrayName="infrastructure" class="row g-3">
        <!-- First item -->
        <div *ngIf="infrastructure.length > 0" [formGroupName]="0" class="col-12">
          <div class="row g-2">
            <div class="col-md-4">
              <select class="form-select" formControlName="roomType">
                <option value="">Select Room Type</option>
                <option value="Hall">Hall</option>
                <option value="Office">Office</option>
                <option value="Store">Store</option>
              </select>
            </div>
            <div class="col-md-4">
              <input class="form-control" formControlName="number" type="number" placeholder="Add number" />
            </div>
            <div class="col-md-4 d-flex align-items-center">
              <button type="button" class="btn btn-outline-danger"
                      *ngIf="infrastructure.length > 1"
                      (click)="infrastructure.removeAt(0)">
                <i class="fas fa-trash me-1"></i>Remove
              </button>
            </div>
          </div>
        </div>

        <!-- Rest items -->
        <ng-container *ngFor="let infra of infrastructure.controls; let i = index">
          <div *ngIf="i > 0" [formGroupName]="i" class="col-12">
            <div class="row g-2">
              <div class="col-md-4">
                <select class="form-select" formControlName="roomType">
                  <option value="">Select Room Type</option>
                  <option value="Hall">Hall</option>
                  <option value="Office">Office</option>
                  <option value="Store">Store</option>
                </select>
              </div>
              <div class="col-md-4">
                <input class="form-control" formControlName="number" type="number" placeholder="Add number" />
              </div>
              <div class="col-md-4 d-flex align-items-center">
                <button type="button" class="btn btn-outline-danger" (click)="infrastructure.removeAt(i)">
                  <i class="fas fa-trash me-1"></i>Remove
                </button>
              </div>
            </div>
          </div>
        </ng-container>

        <div class="col-12 mt-2">
          <button type="button" class="btn btn-outline-primary" (click)="addRoomType()">
            <i class="fas fa-plus me-2"></i>Add Room Type
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Actions -->
  <div class="d-flex justify-content-end mb-5">
    <button type="submit" class="btn btn-primary" [disabled]="branchForm.invalid">
      Save & proceed
    </button>
  </div>
</form>
